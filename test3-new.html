<head>
	<link href="index-main.css" rel="stylesheet" />
</head>
<body>
	<style>
		
	</style>
	<div id="main">
		<div>
			Filter based on location ?
			<button id="filter-start">Yes</button>
		</div>
		<p></p>
	</div>
    <script>
		function nit(data_link) {
			var loc_data;
			
			var rendered = false;
			var renderLoaded = false;
			var dataPresent = false;
			
			function render(){
				if(renderLoaded){
					if(!rendered){
						rendered = true;
						renderer.display(loc_data);
					}
				}
			}
			
			let tag = document.createElement("script");
			tag.src = "render.js";
			document.body.appendChild(tag);
			tag.onload = function(){
				console.log("script-render-loaded");
				renderLoaded = true;
				if(!rendered){
					if(dataPresent){
						rendered = true;
						renderer.display(loc_data);
					}
				}
			}
			
			var r = new XMLHttpRequest();
			r.open("GET", data_link, true);
			r.responseType = "json";
			r.send();
			
			r.onreadystatechange = function(){
				if(r.readyState == 4){
					
					//console.log(r);
					console.log("data got");
					loc_data = r.response.data;
					dataPresent = true;
					render();
					//console.log(loc_data);
				}
			}
		
			//RENDER FUNCTION(){}
		
			let filterBtn = document.getElementById("filter-start");
			filterBtn.addEventListener('click', function(){
				//
				let tag = document.createElement("script");
				tag.src = "jquery.js";
				document.body.appendChild(tag);
				
				let jqLoaded = false;
				let chsnLoaded = false;
				let mainLoaded = false;
				
				tag.onload = function(){
					jqLoaded = true;
					let tag2 = document.createElement("script");
					tag2.src = "chosen.jquery.js";
					document.body.appendChild(tag2);
					
					tag2.onload = function(){
						chsnLoaded = true;
						let tag3 = document.createElement("script");
						tag3.src = "index-main-2.js";
						document.body.appendChild(tag3);
						
						tag3.onload = function(){
							mainLoaded = true;
							customFilter.init(true, loc_data);
						}
					}
				}
				
				let chsnCss = document.createElement('link');
				chsnCss.href = "chosen.css";
				chsnCss.rel = "stylesheet";
				
				document.body.appendChild(chsnCss);
								
			});
		}
		window.addEventListener('load', nit("http://localhost:8080"));
		
    </script>
</body>